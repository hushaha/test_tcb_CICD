# Gitee Actions é…ç½®æ–‡ä»¶
# éƒ¨ç½²åˆ°è…¾è®¯äº‘CloudBaseé™æ€æ‰˜ç®¡

name: Deploy to CloudBase Static Hosting

on:
  push:
    branches:
      - main # ä¸»åˆ†æ”¯æ¨é€æ—¶è§¦å‘
  pull_request:
    branches:
      - main # PRæ—¶è§¦å‘ï¼ˆå¯é€‰ï¼‰

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        
      - name: è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm' # å¯ç”¨npmç¼“å­˜åŠ é€Ÿæ„å»º
          
      - name: å®‰è£…ä¾èµ–
        run: npm ci # ä½¿ç”¨npm ciæ›¿ä»£npm installï¼Œæ›´é€‚åˆCIç¯å¢ƒ
        
      - name: æ„å»ºé¡¹ç›®
        run: npm run build
        
      - name: å®‰è£… CloudBase CLI
        run: npm install -g @cloudbase/cli
        
      - name: ç™»å½• CloudBase CLI
        run: tcb login --apiKeyId ${{ secrets.TCB_SECRET_ID }} --apiKey ${{ secrets.TCB_SECRET_KEY }}
        
      - name: éƒ¨ç½²åˆ° CloudBase é™æ€æ‰˜ç®¡
        run: tcb hosting deploy ./dist /home -e ${{ secrets.TCB_ENV_ID }}
        
      - name: éƒ¨ç½²æˆåŠŸé€šçŸ¥
        if: success()
        run: echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼é¡¹ç›®å·²å‘å¸ƒåˆ° CloudBase é™æ€æ‰˜ç®¡"
        
      - name: éƒ¨ç½²å¤±è´¥é€šçŸ¥
        if: failure()
        run: echo "âŒ éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œæ—¥å¿—"